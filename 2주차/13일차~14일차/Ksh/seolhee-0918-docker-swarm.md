## docker-swarm 이란?
여러 대의 서버를 하나의 클러스터로 묶어 리소스를 병렬로 확장할 때 서로다른 호스트에 있는 여러 대의 컨테이너를 하나의 묶어 마치 하나의 호스트인 것처럼 사용할 수 있도록 도와주는 컨테이너 오케스트레이션 도구이다.

![](https://velog.velcdn.com/images%2Fkorjsh%2Fpost%2Faf590ad3-ca3e-4fc1-a833-f690ab2b71c6%2Fimage.png)

* 타 Orchestration Tool에 비해 기능이 단순
* 초대형 노드 클러스터링에는 무리가 있다.

### 차이점
* 도커에서는 컨테이너가 단위이다.
* 스웜에서는 서비스가 단위이다.
* 서비스는 한개의 컨테이너 또는 다수의 컨테이너가 조합될 수 있는 단위이다.

### Container Orchestration
컨테이너 오케스트레이션이란 컨테이너의 배포, 관리, 확장, 네트워킹을 자동화하는 것을 말한다.

* 프로비저닝 및 배포
* 구성 및 일정 조정
* 리소스 할당
* 컨테이너 가용성
* 컨테이너 스케일링 또는 제거
* 로드 밸런싱 및 트래픽 라우팅
* 컨테이너 모니터링
* 실행된 컨테이너를 기반으로 애플리케이션 설정
* 컨테이너 간 보안유지

`Kubernetes, AWS ECS, Apache Mesos, Docker Swarm` 등이 있다

## Swarm Classic VS Swarm Mode
`스웜 클래식`은 여러 대의 도커 서버를 하나의 지점에서 사용할 수 있도록 단일 접근점을 제공한다.

분산 코디네이터, 에이전트 등을 별도로 실행해야한다

--- 
`스웜 모드`는 마이크로서비스 아키텍처의 컨테이너를 다루기 위한 클러스터링 기능에 초점을 맞추고 있다.

분산 코디네이터, 에이전트 등이 모두 도커 엔진 자체에 내장되어있다.
* 스웜 모드를 일반적으로 더 많이 씀

### 나의 견해

docker-compose는 단일 호스트에서 쓰기 좋았더라면 

docker-swarm은 다중 호스트에서 쓰기 좋다

k8s랑 다른게 없어서.. 컨테이너 쓰는 거 아닌이상 안 쓸 것 같다


## container 클러스터링이란?
정의를 못 찾겠어서 제 언어로 설명하자면
클러스터라는 노드의 집합(1개도 클러스터일 수 있음!)
고성능 서버 하나 두기보다는 적은 비용들로 사온 클러스터로 동일 성능을 구현한다. -> `GMO` 느낌으로 이해하면 편함

### 서버 클러스터
각기 다른 서버들을 하나로 묶어서 하나의 시스템같이 동작하게 함으로써 클라이언트들에게 고가용성의 서비스를 제공하는 것을 말한다. 

클러스터는 높은 수준의 가용성, 안전성, 확장성을 제공하기 위해 하나의 시스템을 이용하는 것보다 두개 그 이상의 시스템을 이용한다.

## docker-swarm 실습해보기

### 클러스터 없이 단일 노드 스웜 모드로 진행하기
참고 : https://velog.io/@korjsh/%EB%8F%84%EC%BB%A4%EC%8A%A4%EC%9B%9C-%EA%B8%B0%EC%B4%88-%EB%B0%8F-%EC%98%88%EC%A0%9C 

예제들을 똑같이 따라했기 때문에 
너무 길어질까봐 엄청 간단한 것만 적었어요!
첨부하라면 추가하겠습니다 :)

![](https://cdn.discordapp.com/attachments/954177766604030013/1153196466819580015/2023-09-18_14.10.55.png)
`docker swarm init`
싱글 노드로 사용하기 위함

![](https://cdn.discordapp.com/attachments/954177766604030013/1153201591814475836/2023-09-18_14.31.18.png)
`docker service ls`
서비스중인것을 확인 할 수 있음

`docker service create`
간단하게 할거기 때문에 컴포즈 파일 없이 진행할거다

![](https://cdn.discordapp.com/attachments/954177766604030013/1153205893123538965/2023-09-18_14.48.25.png)
`docker service create --name registry --publish published=5000,target=5000 registry:2`

### 의미
* --name : 서비스의 이름을 지정한다. 지정하지 않을 경우 임의의 단어 조합으로 생성된다.
* --replicas : 서비스를 구성할 태스크(컨테이너)의 수를 지정한다. 지정된 숫자 만큼의 태스크가 클러스터의 가용 노드에 배치된다.
* --publish : 포트 포워딩을 통해 클러스터 외부에서 해당 서비스로 접근 가능한 포트 경로를 지정한다. 개방시킬 클러스터 노드의 포트 번호(published)와 이에 대응하는 서비스의 포트 번호(target)로 구분된다. 위의 예시는 --publish published=8080,target=80으로 풀어쓸 수도 있다. 만약 따로 지정하지 않는다면, 스웜 매니저(Swarm Manager)가 30000~32767 범위 안에서 임의의 포트를 할당시킨다.

![](https://cdn.discordapp.com/attachments/954177766604030013/1153205213948289044/2023-09-18_14.45.42.png)
`docker service ls`
생겼다!

