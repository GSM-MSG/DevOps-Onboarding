## docker-compose 란?
도커 컴포즈는 컨테이너 여럿을 띄우는 도커 애플리케이션을 정의하고 실행하는 도구이다.

### 왜 도커/다른 툴 안 쓰고??
일단 내 기준 k8s 쓰기엔 너무 오버스펙 같을 때 Docker-compose를 이용한다. 

docker-compose는 단일 호스트 머신의 여러 컨테이너를 제어할 때 좋다 (다중 호스트라면 swarm, k8s 사용)

dockerfile로 image 만들고 그 이미지들 컨테이너화 시켜서 한방에 관리하기엔 compose가 훨~~~씬 편하다
(직접 주입 하는 것들이 많이 줄음!)

## docker-compose 파일 작성
KSH 폴더 안에 있습니다.

## 자신이 작성한 docker-compose 파일을 설명
* 3 버전을 사용했어요 (일반적이라)
    * 3.xx 안 쓰는 건 마이너버전이라 크게 의미 없다고 판단했습니다
    * 3 버전은 2버전과 다르게 도커 스웜과 같이 사용할 수 있어요
* 이미지는 전에 프로젝트 했을 때 만든 앱 이미지와 공식 이미지인 mysql 8.xx 버전을 가져왔습니다.
* 서버 포트가 80번이고 스프링 8080이라서 80:8080으로 연결해줬어요
* mysql이 정상이어야 실행 가능한 앱이라서 먼저 실행하라는 의미로 depends_on 옵션을 추가했습니다.
    * mysql image를 먼저 가져오게 됩니다.
* 디폴트 네트워크에 묶이고 싶지 않아서 자체 네트워크를 정의했는데 특별한 설정은 없습니다.
* mysql 연결하려면 필요한 설정들이라 environment 옵션으로 묶어서 다 할당 해줍니다.

`version` : https://meetup.nhncloud.com/posts/277

## docker-compose 와 관련된 명령어 실습
### depends_on
* depends_on 은 종속성이 준비될 때까지 명시적으로 기다리지 않는다.
* Docker에게 컨테이너 실행 순서(서비스가 시작되고 중지되어야 하는 순서)를 알려준다.
### environment
* Dockerfile의 각종 환경변수를 설정하는 ENV 옵션과 동일하다.
* env_file 옵션으로 환경변수 값이 들어가있는 파일을 읽어올 수도 있다.
### image
* 컨테이너를 생성할 이미지 정의한다.
### expose
* 호스트 내부의 다른 컨테이너들만 액세스가 가능하다.
### ports
* docker run의 -p 옵션에 해당하는 부분이다. yaml 문법에서 호스트 포트:컨테이너 내부포트으로 작성하면 시간으로 해석하기 때문에 쌍따옴표를 붙여줘야 한다.
### build
* build는 이미지를 도커 파일로 따로 만들어서 사용하는 옵션으로 image 설정 대신 사용한다.
### service
* 도커 컴포즈를 이용해서 실행할 컨테이너들의 이름과 그 옵션을 정의한다.
### volumes
* docker run으로 db 컨테이너를 실행할 때 -v 옵션을 사용하여 데이터베이스 컨테이너의 데이터를 로컬 컴퓨터에 저장했던 것과 같다.

https://bentist.tistory.com/76